import React, { useEffect, useState } from "react";
import Viewer from "bpmn-js/lib/NavigatedViewer";
import "bpmn-js/dist/assets/diagram-js.css";
import "bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css";
import axios from "axios";

function App() {
  const [diagram, diagramSet] = useState("");
  const container = document.getElementById("container");
  useEffect(() => {
    if (diagram.length === 0) {
      axios
        .get(
          "https://cdn.staticaly.com/gh/bpmn-io/bpmn-js-examples/master/colors/resources/pizza-collaboration.bpmn"
        )
        .then((r) => {
          diagramSet(r.data);
        })
        .catch((e) => {
          console.log(e);
        });
    }
  }, [diagram]);
  if (diagram.length > 0) {
    const viewer = new Viewer({
      container,
      keyboard: {
        bindTo: document
      }
    });
    viewer
      .importXML(diagram)
      .then(({ warnings }) => {
        if (warnings.length) {
          console.log("Warnings", warnings);
        }

        const elementRegistry = viewer.get("elementRegistry");

        const graphicsFactory = viewer.get("graphicsFactory");

        function setColor(element, stroke, fill) {
          var businessObject = element.businessObject;

          businessObject.di.set("stroke", stroke);
          businessObject.di.set("fill", fill);

          var gfx = elementRegistry.getGraphics(element);

          var type = element.waypoints ? "connection" : "shape";

          graphicsFactory.update(type, element, gfx);
        }

        const element = elementRegistry.get("CalmCustomerTask");

        setColor(element, "green", "yellow");
      })
      .catch((err) => {
        console.log("error", err.message);
      });
  }

  return (
    <div className="App">
      <div
        id="container"
        style={{
          border: "1px solid #000000",
          height: "90vh",
          width: "90vw",
          margin: "auto"
        }}
      ></div>
    </div>
  );
}
export default App;
